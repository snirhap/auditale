
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>New Customer Event</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #f8f9fa; }
        .header-bar {
            background: linear-gradient(90deg, #0d6efd 60%, #6c757d 100%);
            color: #fff;
            padding: 2rem 1rem 1rem 1rem;
            border-radius: 0 0 1rem 1rem;
            margin-bottom: 2rem;
        }
        .card { border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .form-section { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 2rem; }
        .btn-lg { font-size: 1.1rem; }
        label { font-weight: 500; }
    </style>
    <script>
        function showEventFields() {
            var eventType = document.getElementById('event_type').value;
            var sections = document.querySelectorAll('.event-fields');
            sections.forEach(function(section) {
                section.style.display = 'none';
                section.querySelectorAll('input, select, textarea').forEach(function(input) {
                    input.disabled = true;
                });
            });
            var selectedSection = document.getElementById(eventType + '-fields');
            if (selectedSection) {
                selectedSection.style.display = 'block';
                selectedSection.querySelectorAll('input, select, textarea').forEach(function(input) {
                    input.disabled = false;
                });
            }
        }
        window.onload = function() {
            showEventFields();
            document.getElementById('event_type').addEventListener('change', showEventFields);
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header-bar mb-4 d-flex flex-column flex-md-row align-items-md-end justify-content-between">
            <div>
                <h1 class="mb-2"><i class="fa-solid fa-plus"></i> Record New Event for Customer {{ customer.id }}</h1>
                <p class="mb-0">Add a new event for this customer.</p>
            </div>
            <a href="{{ url_for('customers.get_customer', customer_id=customer.id) }}" class="btn btn-light btn-lg shadow-sm mt-3 mt-md-0">
                <i class="fa-solid fa-arrow-left"></i> Back to Customer Details
            </a>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}
        <div class="form-section mb-4">
            <form action="{{ url_for('customers.record_customer_event', customer_id=customer.id) }}" method="post">
                <div class="mb-3">
                    <label for="event_type" class="form-label">Event Type:</label>
                    <select name="event_type" id="event_type" class="form-select" required>
                        <option value="login">Login</option>
                        <option value="feature">Feature</option>
                        <option value="ticket">Ticket</option>
                        <option value="invoice">Invoice</option>
                        <option value="api">API</option>
                    </select>
                </div>
                <div id="login-fields" class="event-fields" style="display:none;">
                    <div class="mb-3">
                        <label for="timestamp_login" class="form-label">Timestamp:</label>
                        <input type="datetime-local" name="timestamp" id="timestamp_login" class="form-control">
                    </div>
                </div>
                <div id="feature-fields" class="event-fields" style="display:none;">
                    <div class="mb-3">
                        <label for="feature_name" class="form-label">Feature name:</label>
                        <input type="text" name="feature_name" id="feature_name" class="form-control"><br>
                    </div>
                    <div class="mb-3">
                        <label for="timestamp_feature" class="form-label">Timestamp:</label>
                        <input type="datetime-local" name="timestamp" id="timestamp_feature" class="form-control">
                    </div>
                </div>
                <div id="ticket-fields" class="event-fields" style="display:none;">
                    <div class="mb-3">
                        <label for="status" class="form-label">Status:</label>
                        <input type="text" name="status" id="status" class="form-control"><br>
                    </div>
                    <div class="mb-3">
                        <label for="created_at" class="form-label">Created At:</label>
                        <input type="datetime-local" name="created_at" id="created_at" class="form-control"><br>
                    </div>
                    <div class="mb-3">
                        <label for="closed_at" class="form-label">Closed At:</label>
                        <input type="datetime-local" name="closed_at" id="closed_at" class="form-control"><br>
                    </div>
                </div>
                <div id="invoice-fields" class="event-fields" style="display:none;">
                    <div class="mb-3">
                        <label for="issued_at" class="form-label">Issued At:</label>
                        <input type="datetime-local" name="issued_at" id="issued_at" class="form-control" required><br>
                    </div>
                    <div class="mb-3">
                        <label for="due_date" class="form-label">Due Date:</label>
                        <input type="datetime-local" name="due_date" id="due_date" class="form-control" required><br>
                    </div>
                    <div class="mb-3">
                        <label for="paid_date" class="form-label">Paid Date:</label>
                        <input type="datetime-local" name="paid_date" id="paid_date" class="form-control"><br>
                    </div>
                    <div class="mb-3">
                        <label for="amount" class="form-label">Amount:</label>
                        <input type="number" step="0.01" name="amount" id="amount" class="form-control" required><br>
                    </div>
                </div>
                <div id="api-fields" class="event-fields" style="display:none;">
                    <div class="mb-3">
                        <label for="endpoint" class="form-label">Endpoint:</label>
                        <input type="text" name="endpoint" id="endpoint" class="form-control"><br>
                    </div>
                    <div class="mb-3">
                        <label for="timestamp_api" class="form-label">Timestamp:</label>
                        <input type="datetime-local" name="timestamp" id="timestamp_api" class="form-control">
                    </div>
                </div>
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg"><i class="fa-solid fa-plus"></i> Record Event</button>
                    <a href="{{ url_for('customers.get_customer', customer_id=customer.id) }}" class="btn btn-light btn-lg"><i class="fa-solid fa-arrow-left"></i> Back to Customer Details</a>
                </div>
            </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
